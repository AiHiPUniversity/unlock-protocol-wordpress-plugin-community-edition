!function(){"use strict";var e={n:function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,{a:o}),o},d:function(t,o){for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.element,o=window.wp.i18n,r=window.wp.plugins,l=window.wp.editPost,c=window.wp.data,n=window.wp.compose,s=window.wp.components,a=window.React,u=window.wp.apiFetch,i=e.n(u);const d=(0,n.compose)([(0,c.withSelect)((e=>{const{getEditedPostAttribute:t}=e("core/editor");return{locks:t("unlockp_full_post_page_locks")||[],ethereumNetworks:t("unlockp_full_post_page_ethereumnetworks")||[]}})),(0,c.withDispatch)((e=>{const{editPost:t}=e("core/editor");return{onUpdateLocks:e=>t({unlockp_full_post_page_locks:e}),onUpdateEthereumNetworks:e=>t({unlockp_full_post_page_ethereumnetworks:e})}}))])((e=>{let{locks:r,ethereumNetworks:l,onUpdateLocks:n,onUpdateEthereumNetworks:u}=e;const[d,p]=(0,a.useState)(null),[k,_]=(0,a.useState)(!1),m=(0,c.useSelect)((e=>{const{getCurrentPostId:t}=e("core/editor");return{id:t()}}),[]),{isSavingPost:w,didPostSaveRequestSucceed:g}=(0,c.useSelect)((e=>{const{isSavingPost:t,didPostSaveRequestSucceed:o}=e("core/editor");return{isSavingPost:t(),didPostSaveRequestSucceed:o()}}),[]);(0,a.useEffect)((()=>{i()({path:"/unlock-protocol/v1/settings"}).then((e=>{let t=e.networks,r=[{label:(0,o.__)("None","unlock-protocol"),value:-1}];Object.entries(t).forEach((e=>{let[t,o]=e;r.push({label:o.network_name,value:o.network_id})})),u(r),(async e=>{try{const t=await i()({path:`/unlock-protocol/v1/get_unlockp_full_post_page_attributes?post_id=${e}`});t&&t.locks&&n(t.locks)}catch(e){console.error("Error fetching lock settings:",e)}})(m.id)})).catch((e=>{}))}),[m.id,k]),(0,a.useEffect)((()=>{!w&&g&&_(!k)}),[w,g,m.id]);const f=(e,t,o)=>{r[e][t]=o,n([...r])};return(0,t.createElement)("div",null,(0,t.createElement)(s.PanelBody,{title:(0,o.__)("Locks","unlock-protocol")},r.map(((e,c)=>(0,t.createElement)("div",{class:"setting-lock"},(0,t.createElement)(s.SelectControl,{label:(0,o.__)("Network","unlock-protocol"),value:e.network,options:l,onChange:e=>f(c,"network",parseInt(e))}),-1!==e.network?(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",{className:"block-label"},(0,o.__)("Lock Address","unlock-protocol")),(0,t.createElement)(s.TextControl,{value:e.address,onChange:e=>f(c,"address",e)})):"",(0,t.createElement)(s.Button,{isSmall:!0,isDestructive:!0,onClick:()=>{(async e=>{r[e];try{const t=await(async(e,t)=>{try{return await i()({path:"/unlock-protocol/v1/delete_unlockp_full_post_page_attributes",method:"POST",data:{post_id:m.id,lock_index:t}})}catch(e){return console.error("Error deleting lock attributes:",e),{success:!1,message:e.message}}})(0,e);if(t&&t.success){const t=[...r];t.splice(e,1),n(t),_(!k),p("Lock deleted successfully")}else{const t=[...r];t.splice(e,1),n(t),p("Empty lock removed")}}catch(e){console.error("Error deleting lock:",e),p(`Failed to delete lock. Error: ${e.message}`)}})(c)}},"Remove"),(0,t.createElement)(s.Button,{className:"save-lock",variant:"primary",style:{backgroundColor:"green",marginLeft:"5px"},onClick:()=>(async(e,t)=>{const o=e.filter((e=>{return-1!==e.network&&e.address&&(t=e.address,/^0x[a-fA-F0-9]{40}$/.test(t));var t}));if(0===o.length)return void p("No valid lock(s) attributes to save.");const r={locks:o,ethereumNetworks:l};try{const e=await i()({path:"/unlock-protocol/v1/save_unlockp_full_post_page_attributes",method:"POST",data:{post_id:t,unlockp_full_post_page_attributes:JSON.stringify(r)}});if(e.success)p("Lock attributes saved successfully"),_(!k);else{const t=e.data;p(`Failed to save Lock attributes. Error: ${t.message||"Unknown error"}`)}}catch(e){p(`Catch Error: ${e.message||"Failed to save Lock attributes"}`)}})(r,m.id)},"Save")))),d&&(0,t.createElement)(s.Notice,{status:"Lock attributes saved successfully"===d?"success":"error",onRemove:()=>p(null)},d),(0,t.createElement)(s.PanelRow,null,(0,t.createElement)(s.Button,{className:"add-lock",variant:"primary",onClick:()=>{let e;e=r?[...r,{address:"",network:-1}]:[{address:"",network:-1}],n(e)}},"Add Lock"))))}));(0,r.registerPlugin)("unlock-protocol-unlock-box-full-post-page",{render:()=>(0,t.createElement)(l.PluginDocumentSettingPanel,{name:"full-post-page-lock",title:(0,o.__)("Unlock Protocol","unlock-protocol")},(0,t.createElement)("p",null,(0,o.__)("Add lock(s) to restrict access to the full post/page content inside of WordPress.","unlock-protocol")),(0,t.createElement)("div",{className:"docs"},(0,t.createElement)("a",{rel:"noopener noreferrer",target:"_blank",href:unlockProtocol.unlock_docs.docs},(0,o.__)("Unlock's documentation","unlock-protocol")),(0,t.createElement)("br",null),(0,t.createElement)("a",{rel:"noopener noreferrer",target:"_blank",href:unlockProtocol.unlock_docs.deploy_lock},(0,o.__)("Deploy a lock","unlock-protocol"))),(0,t.createElement)(d,null))})}();